<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SibelPlanner</title>
  <style>
    :root { --bg:#0b0f14; --panel:#111827; --btn:#1f2937; --txt:#e5e7eb; --mut:#94a3b8; --acc:#22c55e; --line:#334155; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:var(--bg); color:var(--txt); }
    header { position: sticky; top:0; z-index: 10; background: linear-gradient(180deg, #0f172a, #0b0f14); border-bottom:1px solid #1f2937; padding:10px 12px; }
    .row { display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
    .btn { background:var(--btn); border:1px solid var(--line); color:var(--txt); padding:10px 12px; border-radius:12px; font-weight:650; cursor:pointer; user-select:none; }
    .btn.primary { border-color:#16a34a; background:#0b2a16; }
    .btn.danger { border-color:#dc2626; background:#2a0b0b; }
    .btn.on { outline:2px solid var(--acc); }
    input[type="file"]{ display:none; }
    .chip { padding:8px 10px; border:1px solid var(--line); border-radius:999px; color:var(--mut); font-size:12px; }
    .wrap { display:grid; grid-template-columns: 420px 1fr; gap:10px; padding:10px; }
    @media (max-width: 980px){ .wrap { grid-template-columns: 1fr; } }
    .panel { background:var(--panel); border:1px solid #1f2937; border-radius:16px; padding:12px; }
    h3 { margin:0 0 8px; font-size:14px; color:#cbd5e1; }
    p { margin:6px 0; color:var(--mut); font-size:12px; line-height:1.35; }
    .kv { display:flex; justify-content:space-between; gap:10px; font-size:12px; color:var(--mut); }
    .kv b { color: var(--txt); }
    .field, select { width:100%; padding:10px 12px; border-radius:12px; border:1px solid var(--line); background:#0b1220; color:var(--txt); }
    .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
    .canvasWrap { position: relative; border-radius:16px; border:1px solid #1f2937; overflow:hidden; background:#0b1220; }
    canvas { display:block; width:100%; height:auto; touch-action:none; }
    #overlay { position:absolute; left:0; top:0; }
    .list { margin-top:10px; border-top:1px dashed var(--line); padding-top:10px; max-height: 260px; overflow:auto; }
    .item { display:flex; justify-content:space-between; gap:10px; padding:8px; border:1px solid #1f2937; border-radius:12px; margin-bottom:8px; }
    .item small { color: var(--mut); display:block; }
    .hint { color: var(--mut); font-size:12px; }
    .thumbs { display:grid; grid-template-columns: repeat(3, 1fr); gap:8px; }
    .thumb { border:1px solid #1f2937; border-radius:14px; padding:8px; background:#0b1220; cursor:pointer; }
    .thumb.on { outline:2px solid var(--acc); }
    .thumb img { width:100%; height:72px; object-fit:contain; display:block; }
    .thumb div { font-size:11px; color:var(--mut); margin-top:6px; }
    .sep { height:1px; background:#1f2937; margin:10px 0; }
  </style>
</head>
<body>
<header>
  <div class="row">
    <label class="btn primary">PDF laden<input id="filePdf" type="file" accept="application/pdf"/></label>
    <button id="toolSelect" class="btn on">Auswählen</button>
    <button id="toolPan" class="btn">Hand (Pan)</button>
    <button id="toolRoute" class="btn">Fluchtweg</button>
    <button id="toolSymbol" class="btn">Symbol</button>
    <button id="toolText" class="btn">Text</button>
    <button id="btnDelete" class="btn danger">Löschen</button>
    <button id="btnZoomOut" class="btn">−</button>
    <button id="btnZoomIn" class="btn">+</button>
    <span class="chip" id="zoomChip">100%</span>
    <button id="btnPrev" class="btn">◀ Seite</button>
    <button id="btnNext" class="btn">Seite ▶</button>
    <span class="chip" id="pageChip">—</span>
    <button id="btnExport" class="btn">Export PDF</button>
    <button id="btnExportCsv" class="btn">Export CSV</button>
    <button id="btnSave" class="btn">Projekt speichern</button>
    <label class="btn">Projekt laden<input id="fileProject" type="file" accept="application/json"/></label>
    <span class="chip" id="status">Bereit</span>
  </div>
</header>

<div class="wrap">
  <div class="panel">
    <h3>Symbolbibliothek (Basis „volles Pfeil-Spektrum“)</h3>
    <p class="hint">Rettungszeichen: ← → ↑ ↓ ↖ ↗ ↙ ↘ sowie „ohne Pfeil“ + Würfel-Pfeile + Notleuchte/Einzelleuchte. Du kannst eigene Hersteller-SVGs ergänzen.</p>
    <div class="thumbs" id="symGrid"></div>

    <div class="sep"></div>

    <h3>Stromkreise</h3>
    <div class="grid2">
      <input id="circuitName" class="field" placeholder="Neuer Stromkreis (z.B. SB-1)"/>
      <button id="btnAddCircuit" class="btn">+ hinzufügen</button>
    </div>
    <div class="grid2" style="margin-top:8px">
      <select id="circuitSelect"></select>
      <button id="btnAssignCircuit" class="btn">Auswahl zuweisen</button>
    </div>
    <p class="hint">Tipp: Labels werden automatisch als z.B. <b>RZL-03 (SB-1)</b> erzeugt, wenn du „Auto-Label“ nutzt.</p>
    <div class="grid2" style="margin-top:8px">
      <button id="btnAutoLabel" class="btn">Auto-Label (Seite)</button>
      <button id="btnLegend" class="btn">Legende (Seite)</button>
    </div>

    <div class="sep"></div>

    <h3>Eigenschaften (Auswahl)</h3>
    <div class="grid2">
      <input id="selLabel" class="field" placeholder="Beschriftung (z.B. RZL-01 (SB-1))"/>
      <button id="btnRotateObj" class="btn">↻ drehen (90°)</button>
    </div>
    <div class="grid2" style="margin-top:8px">
      <input id="selPhase" class="field" placeholder="Phase (optional z.B. L1)"/>
      <input id="selGroup" class="field" placeholder="Gruppe (optional)"/>
    </div>

    <div class="list">
      <h3>Stückliste (Seite)</h3>
      <div id="inv"></div>
    </div>

    <div style="margin-top:10px">
      <h3>Hinweis zu „Original“-Hersteller-Symbolen</h3>
      <p class="hint">Ich liefere neutrale Symbole. Wenn du Hersteller-SVGs/Icons hast und die Nutzung erlaubt ist, lege sie in <b>assets/symbols</b> und ergänze die Symbol-Liste in <b>renderer.js</b>.</p>
    </div>
  </div>

  <div class="canvasWrap" id="canvasWrap">
    <canvas id="pdfCanvas"></canvas>
    <canvas id="overlay"></canvas>
  </div>
</div>

<script src="./node_modules/pdfjs-dist/build/pdf.min.js"></script>
<script>
  if (window.pdfjsLib) {
    window.pdfjsLib.GlobalWorkerOptions.workerSrc = "./node_modules/pdfjs-dist/build/pdf.worker.min.js";
  }
</script>
<script src="./node_modules/pdf-lib/dist/pdf-lib.min.js"></script>
<script src="./renderer.js"></script>
</body>
</html>
